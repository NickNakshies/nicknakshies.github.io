<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Layout</title>

    <!-- Poppines Font-->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- BootStrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    
    <!--CSS natin-->
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="./profile.css">

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            if (localStorage.getItem("isLoggedIn") !== "true") {
                window.location.href = "/pages/Sign_In_Up/signin.html";  // Redirect to login page
            }
        });
    </script>

</head>
<body>
    <div class="main-window">
        <!-- NAVBAR START -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light px-4 mt-0 ms-3">
            <a class="navbar-brand" href="/Boilerplate/index.html">
                <img src="../../assets/Logo.png" alt="Logo" >
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar content -->
            <div class="collapse navbar-collapse" id="navbarContent">

                <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-0 mt-2">
                    <li class="nav-item fs-3 me-5 ms-4">
                        <a class="nav-link fw-bold" href="/pages/Store/store.html#navbarContent">Featured</a>
                    </li>

                    <li class="nav-item dropdown fs-3 ms-4 me-2">
                        <a class="nav-link dropdown-toggle" href="#" id="storeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Store
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="storeDropdown">
                            <li><a class="dropdown-item" href="/pages/Store/store.html#item-boxes">Item Boxes</a></li>
                            <li><a class="dropdown-item" href="/pages/Store/store.html#Poke-coins">Poke Coins</a></li>
                            <li><a class="dropdown-item" href="/pages/Store/store.html#Daily-bundles">Daily Bundles</a></li>
                        </ul>
                    </li>

                    <li class="nav-item fs-3 ms-4 me-2">
                        <a class="nav-link" href="#footer">About</a>
                    </li>
                </ul>


                <ul class="navbar-nav mb-2 mb-lg-0 me-5">
                    <li class="nav-item me-4 mt-1">
                        <a class="nav-link" href="/pages/Cart/cart.html">
                            <i class="bi bi-cart-fill override-icon rounded-pill bg-primary px-5 py-1" style="font-size: 2.8rem;"></i>
                        </a>
                    </li>
                    <li class="nav-item me-3 mt-2">
                        <a class="nav-link" href="/pages/Past_Orders/orders.html">
                            <i class="bi bi-receipt override-icon rounded-pill bg-danger px-5 py-2"></i>
                        </a>
                    </li>
                    <li class="nav-item me-1">
                        <a class="nav-link" href="../pages/Profile/profile.html">
                            <div class="d-flex align-items-center rounded-pill mt-1 px-4 py-1 fw-bold text-light" style="gap: 10px; background-color: #cbdf72;">Sign In
                                <i class="bi bi-person-circle fs-1 text-light"></i>
                            </div>
                        </a>   
                    </li>
                </ul>
            </div>
        </nav>  

        <!--Profile-->
        <div class="container mt-3 profile-window shadow-lg overflow-scroll">
            <div class="p-4 mt-1 row">
                <h2 class="fw-bold fs-1" style="color: #fdffd6; text-shadow: 2px 2px 5px #727272;">Profile</h2>
            </div>
            <div class="row p-1 ms-4">
                <div class="col-lg-3 ms-4">
                    <form>
                        <label for="file">
                            <div class="profile-pic shadow" id="set-pic" style="background-image: url('https://i.redd.it/what-is-this-pokemon-i-turned-the-silhouette-transparent-to-v0-hf1z6euyfoj91.png?width=512&format=png&auto=webp&s=ad52906606d5eaed2e7f12fb6b78af6430c1c1a1')">
                                <span style="margin-top: -20%;"><i class="bi bi-camera fs-1"></i></span>
                            </div>
                        </label>
                        <input type="file" name="file" id="file" accept="image/*" onchange="loadFile(event)">
                    </form>
                </div>
                <div class="col-md-5 fw-bold fs-4 mt-3 ms-5 me-3 username-fade">
                    <strong class="me-3">User ID:</strong><span id="playerID"></span><br>
                    <strong class="me-3">Joined:</strong><span id="joinDate"></span>
                </div>
                <div class="col ms-1">
                    <div style="position: relative; display: inline-block;" class="viewOrder">
                        <a href="/pages/Past_Orders/orders.html" class="btn rounded-pill bg-primary text-light fs-5 fw-bold px-4 py-3 mt-3 shadow"> View All Orders</a>
                        <img src="../../assets/Pikachu.png" alt="" style="position: absolute; height: 85%; top: -40%; left: 65%;"></img>
                    </div>
                    
                </div>
            </div>
            <div class="row p-4 mt-1 ms-4 fw-bold fs-4 pb-5">
                <div class="col col-lg-3 ms-2">
                    <a href="#" class="profile-link row" style="margin-bottom: 5%;">Profile Settings</a>
                    <a href="/pages/Past_Orders/orders.html" class="profile-link row" style="margin-bottom: 10%;">View Orders</a>
                </div>

                <!--User Info-->
                <div class="col me-5">
                    <div class="row">
                        <div class="col">
                            <label style="color: #fdffd6; text-shadow: 2px 2px 5px #5c5c5c;">Name</label><br>
                            <input type="text" id="name" class="form-control" placeholder="Name" required style="width: 82%;"><br>
                        </div>
                        <div class="col">
                            <label class="fw-bold" style="color: #fdffd6; text-shadow: 2px 2px 5px #5c5c5c;">Password</label>
                            <div class="input-group" style="width: 75%;">
                                <input type="password" class="form-control" id="password" placeholder="Password" required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
              <form id="formValidate">
                    <div class="row">
                        <div class="col">
                            <label style="color: #fdffd6; text-shadow: 2px 2px 5px #5c5c5c;">Email Address</label><br>
                            <input type="email" class="form-control" id="email" placeholder="Email Address" required style="width: 40%;">
                        </div>
                    </div>                    
                </div>

                <!--Log out and Save button-->
                <div class="row" style="margin-top: 5%;">         
                    <div class="col mt-3">
                        <a href="/pages/Sign_In_Up/signin.html" id="logout-btn" class="text-danger profile-link" ><i class="bi bi-power me-3"></i>Log Out</a>
                    </div>    
                    <div class="col offset-lg-6">
                        <button type="submit" class="btn ms-3 rounded-pill bg-primary text-light fs-5 px-4 py-3 fw-bold shadow viewOrder" onclick="saveUserData()"><i class="bi bi-floppy me-2"></i> Save Settings</button>
                    </div>       
                </div>
              </form>
            </div>
        </div>
    </div>

    <footer class="bg-light text-dark py-4" id="footer">
        <div class="container text-center">
          
          <h5>Contact Us</h5>
          <!-- Social Media Icons -->
          <div class="mb-3">
            <a href="#" class=" mx-3">
              <i class="bi bi-youtube text-dark" style="font-size: 1.5rem;"></i>
            </a>
            <a href="#" class=" mx-3 text-dark">
              <i class="bi bi-facebook" style="font-size: 1.5rem;"></i>
            </a>
            <a href="#" class=" mx-3">
              <i class="bi bi-instagram text-dark" style="font-size: 1.5rem;"></i>
            </a>
            <a href="#" class=" mx-3">
              <i class="bi bi-tiktok text-dark" style="font-size: 1.5rem;"></i>
            </a>
          </div>
      
          <!-- Disclaimer -->
          <div class="small fs-5">
            No copyright infringement intended.<br>
            For educational purposes only. <br>All rights reserved.
          </div>
          
        </div>
      </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        
        document.addEventListener("DOMContentLoaded", function() {
            loadSavedData();
        });

        function loadSavedData() {
            let savedImage = localStorage.getItem("profileImage");
            let savedName = localStorage.getItem("playerName");
            let savedEmail = localStorage.getItem("email");
            let savedPassword = localStorage.getItem("signup_password");
            let player_ID = localStorage.getItem("player_ID")

            if (savedImage) document.getElementById("set-pic").style.backgroundImage = `url('${savedImage}')`;
            if (savedName) document.getElementById("name").value = savedName;
            if (savedEmail) document.getElementById("email").value = savedEmail.trim();
            if (savedPassword) document.getElementById("password").value = savedPassword;
            if (player_ID) document.getElementById("playerID").textContent = player_ID;
        }

        document.getElementById("logout-btn").addEventListener("click", function() {    
            localStorage.removeItem("isLoggedIn");
            alert("Logged out successfully!");
        });


        function loadFile(event) {
            event.preventDefault();
            let reader = new FileReader();
            reader.onload = function() {
                let profileImage = reader.result;
                document.getElementById("set-pic").style.backgroundImage = `url('${profileImage}')`;
                localStorage.setItem("profileImage", profileImage);
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function loadJoinDate() {
            const savedJoinDate = localStorage.getItem("joinDate");
            if (savedJoinDate) {
                document.getElementById("joinDate").textContent = savedJoinDate;
            }
        }
        loadJoinDate();

        function saveUserData() {
            event.preventDefault();
            let emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            let profileImage = document.getElementById("set-pic").style.backgroundImage.replace(/url\(["']?/, '').replace(/["']?\)$/, '');
            let name = document.getElementById("name").value;
            let emailInput = document.getElementById("email");
            let email = emailInput.value.trim();
            let password = document.getElementById("password").value;

            if (name == "" || password == "" || email == ""){
                alert("Incomplete fields, Try Again.")
                return;
            } else if (!emailInput.checkValidity() || !emailRegex.test(email)) {
                alert("Invalid email format! Please enter a valid email.");
                document.getElementById("email").value = "";
                return;
           } else {
                localStorage.setItem("profileImage", profileImage);
                localStorage.setItem("playerName", name);
                localStorage.setItem("email", email);
                localStorage.setItem("signup_password", password);
                alert("Profile updated successfully!");
           }
        }

        document.getElementById("formValidate").addEventListener("submit", saveUserData);

        document.getElementById("togglePassword").addEventListener("click", function () {
            let passwordInput = document.getElementById("password");
            passwordInput.type = passwordInput.type === "password" ? "text" : "password";
        });
    </script>
    
</body>
</html>